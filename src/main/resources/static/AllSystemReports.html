<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriGuard AI - Complete System Reports</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-green: #22c55e;
            --primary-dark: #16a34a;
            --secondary-green: #10b981;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --card-bg: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%);
            color: var(--text-primary);
            padding: 20px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .page-header h1 {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }

        .page-header p {
            font-size: 18px;
            color: var(--text-secondary);
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .report-category {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .report-category:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.15);
        }

        .category-header {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            padding: 24px;
            color: white;
        }

        .category-header h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .category-body {
            padding: 24px;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .filter-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .btn-action {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-excel {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-green);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left: 4px solid;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        .toast.success { border-left-color: #22c55e; }
        .toast.error { border-left-color: #ef4444; }
        .toast.warning { border-left-color: #f59e0b; }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
<div class="loading-overlay" id="loadingOverlay">
    <div class="loader"></div>
</div>

<div class="toast-container" id="toastContainer"></div>

<div class="main-container">
    <div class="page-header">
        <h1>Complete System Reports</h1>
        <p>Generate comprehensive reports for all modules in the AgriGuard AI system</p>
    </div>

    <div class="reports-grid">
        <!-- Users Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-users"></i> Users Reports</h2>
                <p>All users, farmers, buyers, admins, analysts, government</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Report Type</label>
                    <select class="filter-select" id="usersReportType">
                        <option value="all">All Users</option>
                        <option value="farmers">Farmers Only</option>
                        <option value="buyers">Buyers Only</option>
                        <option value="admins">Administrators</option>
                        <option value="analysts">Analysts</option>
                        <option value="government">Government Users</option>
                    </select>
                </div>
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="usersDateRange">
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="thisWeek">This Week</option>
                        <option value="lastWeek">Last Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="lastMonth">Last Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="last6Months">Last 6 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="lastYear">Last Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('users', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('users', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Crops Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-seedling"></i> Crops Reports</h2>
                <p>Crop data and management information</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="cropsDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('crops', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('crops', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Farms Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-home"></i> Farms Reports</h2>
                <p>Farm locations and management data</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="farmsDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('farms', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('farms', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Inventory Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-boxes"></i> Inventory Reports</h2>
                <p>Stock levels and inventory management</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="inventoryDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('inventory', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('inventory', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Transactions Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-exchange-alt"></i> Transactions Reports</h2>
                <p>Financial transactions and payments</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="transactionsDateRange">
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="thisWeek">This Week</option>
                        <option value="lastWeek">Last Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="lastMonth">Last Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('transactions', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('transactions', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Crop Production Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-chart-line"></i> Crop Production Reports</h2>
                <p>Production yields and harvests</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="productionDateRange">
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('production', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('production', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Fertilizer Usage Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-flask"></i> Fertilizer Usage Reports</h2>
                <p>Fertilizer application and recommendations</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="fertilizerDateRange">
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('fertilizer', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('fertilizer', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Supply Chain Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-truck"></i> Supply Chain Reports</h2>
                <p>Logistics and distribution data</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="supplyChainDateRange">
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('supplyChain', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('supplyChain', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Market Price Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-chart-bar"></i> Market Price Reports</h2>
                <p>Price trends and market analysis</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="marketPriceDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('marketPrice', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('marketPrice', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Weather Data Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-cloud-sun"></i> Weather Data Reports</h2>
                <p>Weather conditions and forecasts</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="weatherDateRange">
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="thisWeek">This Week</option>
                        <option value="lastWeek">Last Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="lastMonth">Last Month</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('weather', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('weather', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Soil Data Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-mountain"></i> Soil Data Reports</h2>
                <p>Soil analysis and health metrics</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="soilDateRange">
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('soil', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('soil', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Irrigation Data Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-tint"></i> Irrigation Reports</h2>
                <p>Water usage and irrigation schedules</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="irrigationDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('irrigation', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('irrigation', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Environmental Data Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-leaf"></i> Environmental Reports</h2>
                <p>Environmental impact and sustainability</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="environmentalDateRange">
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('environmental', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('environmental', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Climate Impact Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-temperature-high"></i> Climate Impact Reports</h2>
                <p>Climate change effects and adaptation</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="climateImpactDateRange">
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last6Months">Last 6 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('climateImpact', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('climateImpact', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Policy Data Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-landmark"></i> Policy Data Reports</h2>
                <p>Government policies and regulations</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="policyDateRange">
                        <option value="thisMonth" selected>This Month</option>
                        <option value="last3Months">Last 3 Months</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('policy', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('policy', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Recommendations Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-brain"></i> AI Recommendations Reports</h2>
                <p>AI-generated insights and suggestions</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="aiRecommendationDateRange">
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('aiRecommendation', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('aiRecommendation', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Food Security Alerts Reports -->
        <div class="report-category">
            <div class="category-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Food Security Alerts</h2>
                <p>Alert notifications and warnings</p>
            </div>
            <div class="category-body">
                <div class="filter-section">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="foodSecurityDateRange">
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth" selected>This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="allTime">All Time</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-pdf" onclick="generateReport('foodSecurity', 'pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-action btn-excel" onclick="generateReport('foodSecurity', 'excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const BASE_URL = 'http://localhost:8080/api';
    
    // API endpoints for each module
    const API_ENDPOINTS = {
        users: '/users',
        crops: '/crops',
        farms: '/farms',
        inventory: '/inventory',
        transactions: '/transactions',
        production: '/crop-production',
        fertilizer: '/fertilizer-usage',
        supplyChain: '/supply-chain',
        marketPrice: '/market-prices',
        weather: '/weather',
        soil: '/soil-data',
        irrigation: '/irrigation-data',
        environmental: '/environmental-data',
        climateImpact: '/climate-impact',
        policy: '/policy-data',
        aiRecommendation: '/ai-recommendations',
        foodSecurity: '/food-security-alerts'
    };

    // Report titles mapping
    const REPORT_TITLES = {
        users: 'Users Report',
        crops: 'Crops Report',
        farms: 'Farms Report',
        inventory: 'Inventory Report',
        transactions: 'Transactions Report',
        production: 'Crop Production Report',
        fertilizer: 'Fertilizer Usage Report',
        supplyChain: 'Supply Chain Report',
        marketPrice: 'Market Price Report',
        weather: 'Weather Data Report',
        soil: 'Soil Data Report',
        irrigation: 'Irrigation Data Report',
        environmental: 'Environmental Data Report',
        climateImpact: 'Climate Impact Report',
        policy: 'Policy Data Report',
        aiRecommendation: 'AI Recommendations Report',
        foodSecurity: 'Food Security Alerts Report'
    };

    async function generateReport(reportType, format) {
        showLoading(true);

        try {
            // Get date range
            const dateRangeSelectId = `${reportType}DateRange`;
            const dateRangeSelect = document.getElementById(dateRangeSelectId);
            const dateRange = dateRangeSelect ? dateRangeSelect.value : 'thisMonth';

            // Get report-specific type if applicable (for users)
            let subType = null;
            if (reportType === 'users') {
                subType = document.getElementById('usersReportType').value;
            }

            // Fetch data from API
            const endpoint = BASE_URL + API_ENDPOINTS[reportType];
            const response = await fetch(endpoint);
            
            if (!response.ok) {
                throw new Error(`Failed to fetch data: ${response.statusText}`);
            }

            let data = await response.json();

            // Filter by date range
            data = filterByDateRange(data, dateRange);

            // Filter by sub-type for users
            if (reportType === 'users' && subType && subType !== 'all') {
                data = filterUsersByType(data, subType);
            }

            if (data.length === 0) {
                showToast('No data available for the selected criteria', 'warning');
                return;
            }

            // Generate report based on format
            if (format === 'pdf') {
                await generatePDFReport(reportType, data, dateRange, subType);
            } else if (format === 'excel') {
                generateExcelReport(reportType, data, dateRange, subType);
            }

            showToast(`${format.toUpperCase()} report generated successfully`, 'success');

        } catch (error) {
            console.error('Error generating report:', error);
            showToast(`Error generating report: ${error.message}`, 'error');
        } finally {
            showLoading(false);
        }
    }

    function filterByDateRange(data, dateRange) {
        const now = new Date();
        let startDate;

        switch(dateRange) {
            case 'today':
                startDate = new Date(now.setHours(0, 0, 0, 0));
                break;
            case 'yesterday':
                startDate = new Date(now.setDate(now.getDate() - 1));
                startDate.setHours(0, 0, 0, 0);
                break;
            case 'thisWeek':
                const dayOfWeek = now.getDay();
                startDate = new Date(now);
                startDate.setDate(now.getDate() - dayOfWeek);
                startDate.setHours(0, 0, 0, 0);
                break;
            case 'lastWeek':
                const lastWeekStart = new Date(now);
                lastWeekStart.setDate(now.getDate() - now.getDay() - 7);
                lastWeekStart.setHours(0, 0, 0, 0);
                startDate = lastWeekStart;
                break;
            case 'thisMonth':
                startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                break;
            case 'lastMonth':
                startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                break;
            case 'last3Months':
                startDate = new Date(now);
                startDate.setMonth(now.getMonth() - 3);
                break;
            case 'last6Months':
                startDate = new Date(now);
                startDate.setMonth(now.getMonth() - 6);
                break;
            case 'thisYear':
                startDate = new Date(now.getFullYear(), 0, 1);
                break;
            case 'lastYear':
                startDate = new Date(now.getFullYear() - 1, 0, 1);
                break;
            case 'allTime':
                return data;
            default:
                return data;
        }

        return data.filter(item => {
            const itemDate = new Date(item.createdAt || item.date || item.timestamp || Date.now());
            return itemDate >= startDate;
        });
    }

    function filterUsersByType(data, type) {
        switch(type) {
            case 'farmers':
                return data.filter(u => u.role === 'FARMER');
            case 'buyers':
                return data.filter(u => u.role === 'BUYER');
            case 'admins':
                return data.filter(u => u.role === 'ADMIN');
            case 'analysts':
                return data.filter(u => u.role === 'ANALYST');
            case 'government':
                return data.filter(u => u.role === 'GOVERNMENT');
            default:
                return data;
        }
    }

    async function generatePDFReport(reportType, data, dateRange, subType) {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const title = REPORT_TITLES[reportType];

        // Helper function to add logo
        function addLogoToPDF(pdf, x, y, size) {
            try {
                const logoImg = new Image();
                logoImg.src = 'images/logo.jpeg';
                try {
                    pdf.addImage(logoImg, 'JPEG', x, y, size, size, undefined, 'FAST');
                } catch (e) {
                    pdf.setFillColor(22, 163, 74);
                    pdf.circle(x + size/2, y + size/2, size/2, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(size * 0.4);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('AG', x + size/2, y + size/2 + size * 0.15, { align: 'center' });
                }
            } catch (e) {
                pdf.setFillColor(22, 163, 74);
                pdf.circle(x + size/2, y + size/2, size/2, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(size * 0.4);
                pdf.setFont(undefined, 'bold');
                pdf.text('AG', x + size/2, y + size/2 + size * 0.15, { align: 'center' });
            }
        }

        // Header function
        function addHeaderBar(withLogo = false) {
            pdf.setFillColor(34, 197, 94);
            pdf.rect(0, 0, pageWidth, 40, 'F');
            
            pdf.setFillColor(16, 185, 129);
            pdf.setGState(new pdf.GState({opacity: 0.3}));
            pdf.rect(pageWidth * 0.6, 0, pageWidth * 0.4, 40, 'F');
            pdf.setGState(new pdf.GState({opacity: 1}));

            if (withLogo) {
                addLogoToPDF(pdf, 12, 8, 24);
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(20);
                pdf.setFont(undefined, 'bold');
                pdf.text('AgriGuard AI', 42, 18);
                
                pdf.setFontSize(9);
                pdf.setFont(undefined, 'normal');
                pdf.text('Smart Agriculture Management System', 42, 24);
                
                pdf.setFontSize(11);
                pdf.setFont(undefined, 'bold');
                pdf.text(title, 42, 32);
            } else {
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(18);
                pdf.setFont(undefined, 'bold');
                pdf.text('AgriGuard AI', 15, 16);
                
                pdf.setFontSize(9);
                pdf.setFont(undefined, 'normal');
                pdf.text('Smart Agriculture Management System', 15, 22);
                
                pdf.setFontSize(10);
                pdf.setFont(undefined, 'bold');
                pdf.text(title, 15, 30);
            }
        }

        // Add header
        addHeaderBar(true);

        // Report Metadata
        let yPosition = 50;
        
        pdf.setFillColor(248, 250, 252);
        pdf.rect(15, yPosition, pageWidth - 30, 25, 'F');
        pdf.setDrawColor(226, 232, 240);
        pdf.setLineWidth(0.5);
        pdf.rect(15, yPosition, pageWidth - 30, 25, 'S');

        yPosition += 8;
        pdf.setTextColor(60, 60, 60);
        pdf.setFontSize(9);

        const today = new Date();
        pdf.setFont(undefined, 'bold');
        pdf.text('Report Generated:', 20, yPosition);
        pdf.setFont(undefined, 'normal');
        pdf.text(today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }), 65, yPosition);

        yPosition += 7;
        pdf.setFont(undefined, 'bold');
        pdf.text('Total Records:', 20, yPosition);
        pdf.setFont(undefined, 'normal');
        pdf.setTextColor(34, 197, 94);
        pdf.text(`${data.length}`, 65, yPosition);
        pdf.setTextColor(60, 60, 60);

        yPosition += 7;
        pdf.setFont(undefined, 'bold');
        pdf.text('Generated By:', 20, yPosition);
        pdf.setFont(undefined, 'normal');
        pdf.text('AgriGuard AI System', 65, yPosition);

        yPosition += 15;

        // Data section
        pdf.setDrawColor(34, 197, 94);
        pdf.setLineWidth(1);
        pdf.line(15, yPosition, pageWidth - 15, yPosition);
        yPosition += 2;

        pdf.setFontSize(14);
        pdf.setFont(undefined, 'bold');
        pdf.setTextColor(34, 197, 94);
        pdf.text('Report Data', 15, yPosition + 6);
        yPosition += 10;

        pdf.setLineWidth(1);
        pdf.line(15, yPosition, pageWidth - 15, yPosition);
        yPosition += 10;

        // Add simplified data view
        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);
        pdf.setFont(undefined, 'normal');
        pdf.text(`This report contains ${data.length} records for ${title.replace(' Report', '')}`, 15, yPosition);
        yPosition += 8;
        pdf.text(`Date Range: ${dateRange}`, 15, yPosition);
        yPosition += 8;
        pdf.text(`Generated: ${today.toLocaleString()}`, 15, yPosition);

        // Footer
        const totalPages = pdf.internal.getNumberOfPages();
        for (let i = 1; i <= totalPages; i++) {
            pdf.setPage(i);
            pdf.setFontSize(9);
            pdf.setFont(undefined, 'normal');
            pdf.setTextColor(100, 100, 100);
            pdf.text('Â© 2026 AgriGuard AI - Confidential Document', 15, 287);
            pdf.text(`Page ${i} of ${totalPages}`, pageWidth - 15, 287, { align: 'right' });
            pdf.text('www.agriguard.ai', pageWidth - 15, 293, { align: 'right' });
        }

        pdf.save(`AgriGuard_${reportType}_Report_${Date.now()}.pdf`);
    }

    function generateExcelReport(reportType, data, dateRange, subType) {
        const title = REPORT_TITLES[reportType];
        const wsData = [
            [`AgriGuard AI - ${title}`],
            [`Generated: ${new Date().toLocaleString()}`],
            [`Total Records: ${data.length}`],
            [`Date Range: ${dateRange}`],
            []
        ];

        // Add headers based on data structure
        if (data.length > 0) {
            const headers = Object.keys(data[0]);
            wsData.push(headers);

            data.forEach(item => {
                const row = headers.map(header => item[header] || 'N/A');
                wsData.push(row);
            });
        }

        const ws = XLSX.utils.aoa_to_sheet(wsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, title.replace(' Report', ''));

        XLSX.writeFile(wb, `AgriGuard_${reportType}_Report_${Date.now()}.xlsx`);
    }

    function showLoading(show) {
        document.getElementById('loadingOverlay').classList.toggle('show', show);
    }

    function showToast(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<p style="margin: 0; font-weight: 500;">${message}</p>`;
        toastContainer.appendChild(toast);

        setTimeout(() => toast.remove(), 5000);
    }
</script>
</body>
</html>
